# VBA程序文档：TextPartitionAndInsertion

## 概述
`TextPartitionAndInsertion` 是一个用于将长文本分割成较小块并将这些块插入到Microsoft Word文档中表格特定单元格中的VBA脚本。此程序特别适用于将较长的文本整理成结构化的表格内容。

---

## 功能
### 主要特点
1. **文本分割：**
   - 根据每个字符的宽度和预定义的最大宽度，将输入文本分割成较小的块。
   - 处理ASCII和非ASCII字符，并根据其特性进行宽度计算。

2. **表格插入：**
   - 在Word表格中查找标记为`###`的特定单元格。
   - 将分割后的文本块按顺序插入表格第二列的连续行中。

---

## 输入与输出
### 输入：
1. **待分割文本：**
   - 在程序开头定义于`text`变量中。
   - 示例：医疗病例描述或其他较长文本。

2. **最大宽度 (`maxWidth`)：**
   - 指定分割块的最大允许宽度。
   - 默认值：`30`（可根据需要调整）。

3. **Word表格：**
   - 脚本需要Word文档中存在一个预先创建的表格。
   - 表格中的一个单元格应包含`###`，作为插入起始点的标记。

### 输出：
- 分割后的文本从标记为`###`的单元格所在行的第二列开始插入表格，依次占据后续行。

---

## 工作原理
### 1. **文本分割**
   - 遍历`text`变量中的每个字符。
   - 根据以下规则计算字符宽度：
     - 是否为ASCII或非ASCII字符。
     - 后续字符的类型（ASCII或非ASCII）。
   - 将字符累积到一个分割块中，直到添加下一个字符会超过`maxWidth`。
   - 将完成的分割块保存到`partitions`数组中。

### 2. **定位表格起始点**
   - 搜索活动Word文档中第一个表格的各行。
   - 找到第二列中包含标记`###`的行。

### 3. **插入分割后的文本**
   - 从标记行开始将文本块插入表格第二列。
   - 按顺序将每个块插入到后续行中，直到：
     - 所有块插入完成，或
     - 表格行数不足。

---

## 使用说明
1. **设置Word文档：**
   - 在活动的Word文档中创建一个包含至少两列的表格。
   - 在第二列的一个单元格中放置`###`，作为插入起始标记。

2. **配置程序：**
   - 打开Word的VBA编辑器。
   - 将脚本复制粘贴到一个模块中。
   - 修改`text`变量以包含您需要分割的文本。
   - 根据需要调整`maxWidth`变量。

3. **运行脚本：**
   - 确保包含表格的Word文档处于活动状态。
   - 在VBA编辑器中运行`TextPartitionAndInsertion`子例程。

4. **检查输出：**
   - 检查表格，确保文本块从`###`标记处开始正确插入。

---

## 字符宽度计算细节
- 每个字符的宽度根据以下规则动态确定：
  - **非ASCII字符：** 默认宽度为`1`，如果后续字符是ASCII字符，调整为`1.33`。
  - **ASCII字符：** 默认宽度为`0.44`，如果后续字符是非ASCII字符，调整为`0.66`。

---

## 自定义
- **调整最大宽度：**
  - 更改`maxWidth`变量以适应您的文本格式需求。

- **更改目标表格或列：**
  - 如果活动文档包含多个表格，可以修改表格引用（`doc.Tables(1)`）。
  - 更改列索引（`2`表示第二列）以调整插入目标。

---

## 错误处理
- **缺少标记 (`###`)：**
  - 如果未找到标记，脚本将不会插入文本。

- **表格行数不足：**
  - 如果表格没有足够的行容纳所有分割块，脚本将在行数用尽时停止插入。

---

## 示例
### 输入文本：
"10余年前无明显诱因出现口干..."

### 表格执行前：
| 行号 | 第一列    | 第二列    |
|------|-----------|-----------|
|  1   |           |           |
|  2   |           | ###       |
|  3   |           |           |

### 表格执行后：
| 行号 | 第一列    | 第二列    |
|------|-----------|-----------|
|  1   |           |           |
|  2   |           | 块1       |
|  3   |           | 块2       |
|  4   |           | 块3       |

---

## 注意事项
- 在运行脚本之前确保活动Word文档已保存，以防数据丢失。
- 脚本假定文本中不包含干扰Word表格格式的特殊字符。

